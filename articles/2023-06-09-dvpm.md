---
title: "TypeScript ã§ Vim / Neovim ã®è¨­å®šã‚’æ›¸ãï¼"
emoji: "ğŸœ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["vim", "deno", "denops", "neovim"]
published: true
---

:::message
ã“ã®è¨˜äº‹ã¯ [Vim é§…ä¼](https://vim-jp.org/ekiden/) 2023/06/09(é‡‘) ã®è¨˜äº‹ã§ã™ã€‚

å‰å›ã¯ sontixyou ã•ã‚“ã® [Neovimã§ä»Šé–‹ã„ã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ã‚’ã‚³ãƒ”ãƒ¼ã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œã£ãŸè©±](https://zenn.dev/kenkenlysh/articles/9d6d8c40229d55) ã§ã™ã€‚
æ¬¡å›ã¯ 2023/06/12(æœˆ) ã«å…¬é–‹ã•ã‚Œã‚‹äºˆå®šã§ã™ã€‚
:::

## ã¯ã˜ã‚ã«

Vim / Neovim ã«ã¯ã‚¨ãƒ‡ã‚£ã‚¿ã®è¨­å®šã‚’è¡Œã†ã‚¹ã‚¯ãƒªãƒ—ãƒˆè¨€èªã¨ã—ã¦ã€ `Vim script` ã¨ã„ã†ã‚‚ã®ãŒã‚ã‚Šã¾ã™ã€‚
ã¾ãŸã€æœ€è¿‘ã ã¨ Vim ã§ã¯ `Vim9 script` ã€ Neovim ã§ã¯ `Lua` ã‚’ä½¿ç”¨ã—ã¦è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›¸ãã“ã¨ã‚‚ã§ãã¾ã™ã€‚
ã§ã™ãŒã€ `Vim9 script` ã¯ Vim ã§ã—ã‹ä½¿ç”¨ã§ããšã€ `Lua` ã¯  Neovim ã§ã—ã‹ä½¿ç”¨ã§ãã¾ã›ã‚“ã€‚(ä¸€éƒ¨ã¯ Vim ã§ã‚‚ä½¿ç”¨ã§ãã¾ã™ã€‚)
ã“ã® Vim ã¨ Neovim ã®å·®ã¯å¾ã€…ã«å¤§ãããªã£ã¦ãã¦ã„ã‚‹æ°—ãŒã—ã¦ã„ã¾ã™ã€‚

ãã‚“ãªä¸­ã€ [Deno](https://deno.com/runtime) ã‚’ä½¿ç”¨ã—ã¦ Vim / Neovim ä¸¡å¯¾å¿œã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä½œæˆã§ãã‚‹ [denops.vim](https://github.com/vim-denops/denops.vim)
ã¨ã„ã†ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ãŒã§ãã¦ã„ã‚‹ã®ã¯ã”å­˜çŸ¥ã®æ–¹ã‚‚å¤šã„ã®ã§ã¯ãªã„ã§ã—ã‚‡ã†ã‹ã€‚

ä»¥ä¸‹ã«ã„ãã¤ã‹ã®æœ‰åãªãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

- [Shougo/ddc.vim: Dark deno-powered completion framework for neovim/Vim8](https://github.com/Shougo/ddc.vim)
- [Shougo/ddu.vim: Dark deno-powered UI framework for neovim/Vim8](https://github.com/Shougo/ddu.vim)
- [lambdalisue/gin.vim: ğŸ¥ƒ Gin makes you drunk on Git](https://github.com/lambdalisue/gin.vim)


ã¾ãŸã€GitHubã®ã€Œvim-denopsã‚¿ã‚°ã€ ( https://github.com/topics/vim-denops ) ã§ã¯ã€ã€Œdenops.vimã€è£½ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ã•ã‚‰ã«æ¢ã™ã“ã¨ãŒã§ãã¾ã™ã€‚

ç§ã‚‚ã“ã® [denops.vim](https://github.com/vim-denops/denops.vim) ãŒå¥½ãã§ã€ã„ãã¤ã‹ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’è‡ªåˆ†ç”¨ã«ä½œã£ã¦ãã¾ã—ãŸã€‚

æœ¬è¨˜äº‹ã¯ã€ç§ã®ãã® [denops.vim](https://github.com/vim-denops/denops.vim) å¥½ããŒåº¦ã‚’è¶…ãˆã¦ã€ã¤ã„ã«ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã ã‘ã§ãªãè¨­å®šã‚‚ [denops.vim](https://github.com/vim-denops/denops.vim) ã‚’åˆ©ç”¨ã—ã¦æ›¸ãã‚ˆã†ã«ãªã£ã¦ã—ã¾ã£ãŸãƒ»ãƒ»ãƒ»ã¨ã„ã†ã¡ã‚‡ã£ã¨ç‰¹æ®Šã§å¤‰æ…‹ã¡ã£ããªå†…å®¹ã«ãªã£ã¦ã„ã¾ã™ãƒ»ãƒ»ãƒ»ã€‚

<!-- more -->

## dvpm (Denops Vim / Neovim Plugin Manager)

è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ [denops.vim](https://github.com/vim-denops/denops.vim) ã§æ›¸ãã¨ã„ã†ã“ã¨ã¯ã€ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã«ã¤ã„ã¦ã‚‚è‡ªåˆ†ã§ä½•ã‹ã—ã‚‰ã®æ‰‹æ®µã‚’ç”¨æ„ã—ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€‚
ãã“ã§ã€ [denops.vim](https://github.com/vim-denops/denops.vim) ã‚’åˆ©ç”¨ã—ãŸãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã‚’ä½œæˆã—ã¦ã¿ã¾ã—ãŸã€‚
è©³ç´°ã¯ä»¥ä¸‹ã®ãƒªãƒã‚¸ãƒˆãƒªã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

https://github.com/yukimemi/dvpm

ã“ã‚Œè‡ªä½“ã¯ [denops.vim](https://github.com/vim-denops/denops.vim) ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã¯ãªãã€ [denops.vim](https://github.com/vim-denops/denops.vim) ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‹ã‚‰åˆ©ç”¨ã™ã‚‹ãŸã‚ã® [Deno](https://deno.com/runtime) ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨ãªã‚Šã¾ã™ã€‚(ä½•ã‚’è¨€ã£ã¦ã„ã‚‹ã‹ã‚ã‹ã‚‰ãªã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚)

ä½¿ã„æ–¹ã¯ [README](https://github.com/yukimemi/dvpm/blob/main/README.md) ã«è¨˜è¼‰ã—ã¦ã„ã¾ã™ãŒã€ã¾ãšã¯å‰ææ¡ä»¶ã¨ãªã‚‹ [Deno](https://deno.com/runtime)  ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

å…¬å¼ã‚µã‚¤ãƒˆã«ã‚ˆã‚‹ã¨ä»¥ä¸‹ã‚³ãƒãƒ³ãƒ‰ã§ç°¡å˜ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã‚‹ã‚ˆã†ã§ã™ã€‚

- Mac / Linux
```sh
curl -fsSL https://deno.land/x/install/install.sh | sh
```

- Windows
```sh
irm https://deno.land/install.ps1 | iex
```

æ¬¡ã«ã€Vim / Neovim ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã«ä»¥ä¸‹ã‚’è¨˜è¼‰ã—ã¾ã™ã€‚

#### Neovim ã®å ´åˆ
- ~/.config/nvim/init.lua (Mac / Linux)
- ~/AppData/Local/nvim/init.lua (Windows)

```lua
local denops = vim.fn.expand("~/.cache/nvim/dvpm/github.com/vim-denops/denops.vim")
if not vim.loop.fs_stat(denops) then
  vim.fn.system({ "git", "clone", "https://github.com/vim-denops/denops.vim", denops })
end
vim.opt.runtimepath:prepend(denops)
```

#### Vim ã®å ´åˆ

- ~/.vimrc (Mac / Linux)
- ~/_vimrc (Windows)

```vim
let s:denops = expand("~/.cache/vim/dvpm/github.com/vim-denops/denops.vim")
if !isdirectory(s:denops)
  execute 'silent! !git clone https://github.com/vim-denops/denops.vim ' .. s:denops
endif
execute 'set runtimepath^=' . substitute(fnamemodify(s:denops, ':p') , '[/\\]$', '', '')
```

[denops.vim](https://github.com/vim-denops/denops.vim) ã‚’ git clone ã—ã¦ runtimepath ã¸è¿½åŠ ã—ã¦ã„ã¾ã™ã€‚
ã“ã“ã ã‘ã¯ `Vim script` / `Lua` ã«ã‚ˆã‚‹è¨˜è¿°ãŒå¿…è¦ã§ã™ã€‚
æ—¢ã«è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãŠæŒã¡ã®æ–¹ãŒã»ã¨ã‚“ã©ã‹ã¨æ€ã„ã¾ã™ã®ã§ã€ Neovim ã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹å ´åˆã¯ã€ Vimé§…ä¼ 2023/05/26 ã®è¨˜äº‹ [Neovimã®è¨­å®šã™ã¹ã¦ã‚’ã¾ã‚‹ã£ã¨åˆ‡ã‚Šæ›¿ãˆã‚‰ã‚Œã‚‹ãƒãƒ«ãƒãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«é‹ç”¨](https://zenn.dev/kyoh86/articles/e27a93d78767a7) ã‚’å‚è€ƒã«ä¸€æ™‚çš„ã«åˆ‡ã‚Šæ›¿ãˆã¦è©¦ã—ã¦ã¿ã‚‹ã“ã¨ã‚’ãŠã™ã™ã‚ã—ã¾ã™ã€‚

ãã‚Œã§ã¯ã€ã„ã‚ˆã„ã‚ˆè¨˜äº‹ã‚¿ã‚¤ãƒˆãƒ«ã«ã‚‚ã‚ã‚‹é€šã‚Šã€ [TypeScript](https://www.typescriptlang.org/) ([Deno](https://deno.com/runtime)) ã‚’ä½¿ç”¨ã—ã¦è¨­å®šã‚’æ›¸ã„ã¦ã„ãã¾ã™ã€‚

ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚
ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã¯ç•°ãªã‚Šã¾ã™ãŒã€ä¸­èº«ã¯åŒã˜ã§ã™ã€‚

#### Neovim ã®å ´åˆ
- ~/.config/nvim/denops/config/main.ts (Mac / Linux)
- ~/AppData/Local/nvim/denops/config/main.ts (Windows)

#### Vim ã®å ´åˆ
- ~/.vim/denops/config/main.ts (Mac / Linux)
- ~/vimfiles/denops/config/main.ts (Windows)

```typescript
import * as fn from "https://deno.land/x/denops_std@v5.0.0/function/mod.ts";
import * as mapping from "https://deno.land/x/denops_std@v5.0.0/mapping/mod.ts";
import { Denops } from "https://deno.land/x/denops_std@v5.0.0/mod.ts";
import { ensureString } from "https://deno.land/x/unknownutil@v2.1.1/mod.ts";
import { execute } from "https://deno.land/x/denops_std@v5.0.0/helper/mod.ts";
import { globals } from "https://deno.land/x/denops_std@v5.0.0/variable/mod.ts";

import { Dvpm } from "https://deno.land/x/dvpm@1.0.0/mod.ts";

export async function main(denops: Denops): Promise<void> {

  // ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ãƒ™ãƒ¼ã‚¹ã¨ãªã‚‹ãƒ‘ã‚¹ã§ã™ã€‚
  const base_path = (await fn.has(denops, "nvim"))
    ? "~/.cache/nvim/dvpm"
    : "~/.cache/vim/dvpm";
  const base = ensureString(await fn.expand(denops, base_path));

  // ãƒ™ãƒ¼ã‚¹ãƒ‘ã‚¹ã‚’å¼•æ•°ã«ã€ Dvpm.begin ã‚’å®Ÿè¡Œã—ã¦ã€ `dvpm` ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’å–å¾—ã—ã¾ã™ã€‚
  const dvpm = await Dvpm.begin(denops, { base });

  // ä»¥é™ã¯ `dvpm.add` ã‚’ç”¨ã„ã¦å¿…è¦ãªãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’è¿½åŠ ã—ã¦ã„ãã¾ã™ã€‚
  await dvpm.add({ url: "yukimemi/dps-autocursor" });

  // ãƒ–ãƒ©ãƒ³ãƒã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚
  // await dvpm.add({ url: "neoclide/coc.nvim", branch: "release" });

  // build ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ã¯ã€ `install` ã‹ `update` å®Ÿæ–½å¾Œã«å®Ÿè¡Œã™ã‚‹å‡¦ç†ã‚’è¨˜è¼‰ã§ãã¾ã™ã€‚
  // `Denops` ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆä»¥å¤–ã«ã€ `PlugInfo` ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å¼•æ•°ã«å–ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚
  // å«ã¾ã‚Œã¦ã„ã‚‹æƒ…å ±ã«ã¤ã„ã¦ã¯ README ã‚’å‚ç…§ãã ã•ã„ã€‚
  await dvpm.add({
    url: "neoclide/coc.nvim",
    branch: "master",
    build: async ({ info }) => {
      const args = ["install", "--frozen-lockfile"];
      const cmd = new Deno.Command("yarn", { args, cwd: info?.dst });
      const output = await cmd.output();
      console.log(new TextDecoder().decode(output.stdout));
    },
  });

  // `before` ã¯ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒ runtimepath ã¸è¿½åŠ ã•ã‚Œã‚‹å‰ã«å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚
  await dvpm.add({
    url: "yukimemi/dps-autobackup",
    before: async ({ denops }) => {
      // `denops_std` ã®é–¢æ•°ã§ Vim ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã‚’ã‚»ãƒƒãƒˆã—ã¦ã„ã¾ã™ã€‚
      // let g:autobackup_dir = "~/.cache/autobackup" ã¨ç­‰ä¾¡ã€‚
      await globals.set(denops,
        "autobackup_dir",
        ensureString(await fn.expand(denops, "~/.cache/autobackup")),
      );
    },
  });
  // `after` ã¯ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ runtimepath ã¸è¿½åŠ ã—ãŸå¾Œã«å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚
  await dvpm.add({
    url: "folke/which-key.nvim",
    after: async ({ denops }) => {
      // `denops_std` ã®é–¢æ•° `execute` ã§ã¯ Vim ã®ã‚³ãƒãƒ³ãƒ‰ãŒãªã‚“ã§ã‚‚å®Ÿè¡Œå¯èƒ½ã§ã™ã€‚
      await execute(denops, `lua require("which-key").setup()`);
    },
  });

  // `dst` ã§ãƒ™ãƒ¼ã‚¹ãƒ‘ã‚¹ã¨ã¯åˆ¥ã®å ´æ‰€ã«ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ clone ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚
  // é–‹ç™ºæ™‚ãªã©ã«ä¾¿åˆ©ã€‚
  await dvpm.add({
    url: "yukimemi/dps-randomcolorscheme",
    dst: "~/src/github.com/yukimemi/dps-randomcolorscheme",
    before: async ({ denops }) => {
      // `denops_std` ã® `mapping` ç”¨é–¢æ•°ã‚’åˆ©ç”¨ã™ã‚‹ã¨ã‚­ãƒ¼ãƒãƒƒãƒ”ãƒ³ã‚°è¨­å®šãŒã§ãã¾ã™ã€‚
      await mapping.map(denops, "<space>ro", "<cmd>ChangeColorscheme<cr>", { mode: "n" });
      await mapping.map(denops, "<space>rd", "<cmd>DisableThisColorscheme<cr>", { mode: "n" });
      await mapping.map(denops, "<space>rl", "<cmd>LikeThisColorscheme<cr>", { mode: "n" });
      await mapping.map(denops, "<space>rh", "<cmd>HateThisColorscheme<cr>", { mode: "n" });
    },
  });
  //  ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã® æœ‰åŠ¹ / ç„¡åŠ¹ã¯ `enabled` ã§åˆ‡ã‚Šæ›¿ãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
  await dvpm.add({
    url: "yukimemi/dps-hitori",
    enabled: false,
  });
  // `enabled` ã«ã¯é–¢æ•°æŒ‡å®šã‚‚ã§ãã‚‹ã®ã§ ä¸‹è¨˜ã®ã‚ˆã†ã« Vim ã ã‘æœ‰åŠ¹ãªã©ã®æŒ‡å®šãŒå¯èƒ½ã§ã™ã€‚
  await dvpm.add({
    url: "editorconfig/editorconfig-vim",
    enabled: async ({ denops }) => !(await fn.has(denops, "nvim")),
  });
  // `dependencies` ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§ã€ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒ runtimepath ã¸è¿½åŠ ã•ã‚Œã‚‹é †åºã‚’åˆ¶å¾¡ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
  await dvpm.add({
    url: "kana/vim-textobj-entire",
    dependencies: [{ url: "kana/vim-textobj-user" }],
  });

  // æœ€å¾Œã« dvpm.end ã‚’å‘¼ã¹ã°å®Œäº†ã§ã™ã€‚
  await dvpm.end();

  console.log("Load completed !");
}
```

ã‚³ãƒ¡ãƒ³ãƒˆéƒ¨åˆ†ã«å®Ÿæ–½ã—ã¦ã„ã‚‹å†…å®¹ã‚’ç°¡å˜ã«è¨˜è¼‰ã—ã¦ã„ã‚‹ã®ã§ã€å¤§ã¾ã‹ãªå†…å®¹ã¯ç†è§£ã§ãã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚
ä¸Šè¨˜ã®ã‚³ãƒ¼ãƒ‰ã‚’ä¿å­˜ã—ã¦ Vim / Neovim ã‚’å†èµ·å‹•ã™ã‚‹ã¨ã€ `dvpm.add` ã§æŒ‡å®šã—ãŸãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã‚‹ã¯ãšã§ã™ã€‚

æŒ‡å®šã§ãã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®è©³ç´°ã¯ãƒªãƒã‚¸ãƒˆãƒªã® README ã‚’å‚ç…§ãã ã•ã„ã€‚

https://github.com/yukimemi/dvpm#api

## ä»•çµ„ã¿ã«ã¤ã„ã¦

å®Ÿã¯ä¸Šè¨˜ã§è¡Œã£ã¦ã„ã‚‹ã“ã¨ã¯ [denops.vim](https://github.com/vim-denops/denops.vim) ã‚’åˆ©ç”¨ã—ãŸãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä¸€ã¤ä½œæˆã—ãŸã€ã¨ã„ã†ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

[Deno ã§ Vim/Neovim ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’æ›¸ã (denops.vim)](https://zenn.dev/lambdalisue/articles/b4a31fba0b1ce95104c9#1.-%E3%83%97%E3%83%A9%E3%82%B0%E3%82%A4%E3%83%B3%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E6%A7%8B%E9%80%A0%E3%81%AE%E4%BD%9C%E6%88%90)

ã®è¨˜äº‹ã«ã‚ã‚‹ã‚ˆã†ã«ã€ [denops.vim](https://github.com/vim-denops/denops.vim) ã¯è‡ªå‹•çš„ã« runtimepath å†…ã® `denops/*/main.ts` ã‚’èª­ã¿è¾¼ã¿ã€ `*` ã®éƒ¨åˆ†ã‚’ãƒ—ãƒ©ã‚°ã‚¤ãƒ³åã¨ã—ã¦ç™»éŒ²ã—ã¾ã™ã€‚
ãã—ã¦ã€ `main` é–¢æ•°ãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚
ã“ã®ã‚³ãƒ¼ãƒ‰ã§ã¯ `denops/config/main.ts` ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ã„ã‚‹ã®ã§ã€ `config` ã¨ã„ã†åå‰ã® [denops.vim](https://github.com/vim-denops/denops.vim) ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä½œæˆã—ã¦ã„ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚(ã“ã‚Œã§ã‚ãªãŸã‚‚ç«‹æ´¾ãª [denops.vim](https://github.com/vim-denops/denops.vim) ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ä½œæˆè€…ã§ã™ï¼)
â€»è¨­å®šã¨ã—ã¦è¨˜è¼‰ã™ã‚‹ãŸã‚ã« `config` ã¨ã„ã†åå‰ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ãŒã€è‡ªåˆ†ã®å¥½ããªåå‰ã«å¤‰æ›´ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚(`config` ã¨ã„ã†åå‰ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯ã•ã™ãŒã«ãªã„ã¨æ€ã†ã®ã§è¡çªã®å¿ƒé…ã¯ãªã„ã¯ãšã§ã™ãƒ»ãƒ»ãƒ»)

ã“ã® [denops.vim](https://github.com/vim-denops/denops.vim) ã®ä»•çµ„ã¿ã«ä¹—ã£ã¦ä½œæˆã•ã‚ŒãŸ `config` ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ä¸­ã‹ã‚‰å‘¼ã³å‡ºã—ã¦åˆ©ç”¨ã—ã¦ã„ã‚‹ã®ãŒ [yukimemi/dvpm: dvpm - Denops Vim/Neovim Plugin Manager](https://github.com/yukimemi/dvpm) ã«ãªã‚Šã¾ã™ã€‚

ãã®ãŸã‚ã€å‰è¿°ã—ãŸã‚ˆã†ã« [dvpm](https://github.com/yukimemi/dvpm) è‡ªä½“ã¯ [denops.vim](https://github.com/vim-denops/denops.vim) ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã¯ãªãã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä½œæˆã™ã‚‹ [denops.vim](https://github.com/vim-denops/denops.vim) ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã‚ã‚‹ `config` ã‹ã‚‰å‘¼ã³å‡ºã•ã‚Œã‚‹ [Deno](https://deno.com/runtime) ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨ã„ã†ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

## ç‰¹å¾´

ã“ã®è¨­å®šæ–¹æ³•ã®ç‰¹å¾´ã¯ã€ãªã‚“ã¨ã„ã£ã¦ã‚‚ Vim / Neovim ã®èµ·å‹•é€Ÿåº¦ã§ã™ï¼ï¼
ç§è‡ªèº«ã€ç¾åœ¨ 202 å€‹ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ãŒã€ [dstein64/vim-startuptime](https://github.com/dstein64/vim-startuptime) ã‚’ä½¿ç”¨ã—ã¦èµ·å‹•æ™‚é–“ã‚’è¨ˆæ¸¬ã—ãŸçµæœã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

![neovim-startuptime](https://github.com/yukimemi/zenn-dev/blob/master/articles/img/neovim-startuptime.png?raw=true)

13.6 ï¼ï¼ï¼ã‚ã¡ã‚ƒã‚ã¡ã‚ƒé€Ÿã„ï¼ï¼ï¼

ãƒ»ãƒ»ãƒ»ã¯ã„ãƒ»ãƒ»ãƒ»ãŸã ã—ã€å®Ÿã¯ã“ã®çµæœã¯ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒã¾ã£ãŸãèª­ã¿è¾¼ã¾ã‚Œã¦ã„ãªã„æ™‚é–“ã«ãªã‚Šã¾ã™ãƒ»ãƒ»ãƒ»ã€‚
ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ã©ã‚Œã ã‘å…¥ã‚Œã¦ã„ã‚‹ã‹ã¯èµ·å‹•æ™‚é–“ã«ã¯é–¢ä¿‚ã—ã¾ã›ã‚“ã€‚
å®Ÿéš›ã«ã¯ã€ Vim / Neovim èµ·å‹•æ™‚ã«ã¯ [denops.vim](https://github.com/vim-denops/denops.vim) ã®ã¿ãŒèª­ã¿è¾¼ã¾ã‚Œã€ [denops.vim](https://github.com/vim-denops/denops.vim) ãŒå…ˆç¨‹è‡ªä½œã—ãŸ `config` ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’èª­ã¿è¾¼ã¿ã€ã•ã‚‰ã«ãã‚Œã‹ã‚‰ [dvpm](https://github.com/yukimemi/dvpm) ãŒãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ runtimepath ã«è¿½åŠ ã—ã¦ã„ãå‡¦ç†ãŒãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚
ã¤ã¾ã‚Šã€èµ·å‹•ç›´å¾Œã¯ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ãŒã€ã©ã‚Œã ã‘ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’å°å…¥ã—ã¦ã‚‚ Vim / Neovim ã®èµ·å‹•æ™‚é–“ã¯åŠ£åŒ–ã—ã¾ã›ã‚“ã€‚

è‡ªåˆ†ã®å ´åˆã¯ã€ Windows ã§ Vim / Neovim ã®èµ·å‹•æ™‚é–“ãŒæ°—ã«ãªã£ã¦ã„ãŸãŸã‚ã€ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒä½¿ç”¨ã§ããªãã¦ã‚‚ã¨ã‚Šã‚ãˆãšæœ€é€Ÿã§èµ·å‹•ã—ã¦ãã‚Œã‚‹ã“ã®è¨­å®šæ–¹æ³•ã¯ã‘ã£ã“ã†æ°—ã«å…¥ã£ã¦ã„ã¾ã™ã€‚


#### åˆã†ã¨æ€ã‚ã‚Œã‚‹äºº
- Windows ã§ Vim / Neovim ã®èµ·å‹•æ™‚é–“ãŒæ°—ã«ãªã‚‹äºº
- ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ãƒ¼ãƒ©ãƒ¼ãªã©ã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç›´æ¥é–‹ã„ã¦ã€å³åº§ã«å†…å®¹ã‚’è¡¨ç¤ºã—ãŸã„äºº
- ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‹ã‚‰ç›´æ¥ãƒ•ã‚¡ã‚¤ãƒ«æŒ‡å®šã—ã¦ Vim / Neovim ã‚’èµ·å‹•ã™ã‚‹äºº
- èµ·å‹•ç›´å¾Œã¯ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãªã—ã§ã‚‚ç´ ã® Vim / Neovim ã§å•é¡Œãªãæ“ä½œã§ãã‚‹äºº
- TypeScript ãŒå¤§å¥½ããªäºº

#### åˆã‚ãªã„ã¨æ€ã‚ã‚Œã‚‹äºº
- Vim / Neovim ã‚’èµ·å‹•ã—ã¦ã€ FF (ddu ã‚„ Telescope) ãªã©ã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ãäºº
- å¿…è¦ãªãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯èµ·å‹•ç›´å¾Œã‹ã‚‰æœ‰åŠ¹ã«ãªã£ã¦ã„ã‚‹ã“ã¨ã‚’æœ›ã‚€äºº

---

[Deno](https://deno.com/runtime) ã¯éå¸¸ã«å„ªã‚Œã¦ãŠã‚Šã€ååˆ†ãªé€Ÿåº¦ã‚’æŒã£ã¦ã„ã‚‹ãŸã‚ã€èµ·å‹•ç›´å¾Œã¯ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯æœ‰åŠ¹ã§ã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€æ¯”è¼ƒçš„ã™ãã«ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ãã®ãŸã‚ç¾çŠ¶ç§ã¯å›°ã£ã¦ã„ã¾ã›ã‚“ã€‚
ãŸã ã—ã€ [denops.vim](https://github.com/vim-denops/denops.vim) ã§è¨­å®šã‚’è¨˜è¼‰ã™ã‚‹ã€ã¨ã„ã†æ–¹æ³•ã¯ä¸€èˆ¬çš„ã§ã¯ãªã„ãŸã‚ã€è¨­å®šæ–¹æ³•ã«ã¤ã¾ãšãã“ã¨ãŒå¤šã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

[denops_std](https://deno.land/x/denops_std/mod.ts) ã®å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã¯ã€ã•ã¾ã–ã¾ãªè¨­å®šæ–¹æ³•ãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹ã®ã§èª­ã‚“ã§ã¿ã¦ãã ã•ã„ã€‚

ã¾ãŸã€ç§ã®è¨­å®šã‚‚å‚è€ƒã«ã¯ãªã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚
é€šå¸¸ã® [Deno](https://deno.com/runtime) ã¨åŒæ§˜ã«ã€è¨­å®šã‚’åˆ†å‰²ã—ã¦åˆ¥ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ `import` ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

[dotfiles/.config/nvim at main Â· yukimemi/dotfiles Â· GitHub](https://github.com/yukimemi/dotfiles/tree/main/.config/nvim)

[ddc](https://github.com/Shougo/ddc.vim) ã‚„ [ddu](https://github.com/Shougo/ddu.vim) ã®ã‚ˆã†ã«ã€ JSON ã®ã‚ˆã†ãªå¼•æ•°ã§è¨­å®šã‚’è¡Œã†ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯éå¸¸ã«æ›¸ãã‚„ã™ã„ã§ã™ã€‚(å®Ÿã¯æœ€è¿‘ TypeScript ã§è¨­å®šãŒã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸã‚‰ã—ã„ã®ã§ãã£ã¡ã®ã»ã†ãŒè‰¯ã„ã¨æ€ã„ã¾ã™ãƒ»ãƒ»ãƒ»ã€‚)

ä¾‹ãˆã°ã€ç§ã®ç¾æ™‚ç‚¹ã®è¨­å®šã¯ä»¥ä¸‹ã«ãªã‚Šã¾ã™ã€‚

https://github.com/yukimemi/dotfiles/blob/ebea69cc24b377fbdbb8606423813ee4e199a998/.config/nvim/denops/config/plugins/ddc.ts#L108-L147

ä¸€æ–¹ã§ã€ `Lua` ã§ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’å«ã‚€å ´åˆã¯ã†ã¾ãæ›¸ãã“ã¨ãŒã§ããªã„ãŸã‚ã€ `execute` ã‚’ä½¿ã£ã¦ç›´æ¥æ›¸ã„ã¦ã—ã¾ã†ã“ã¨ã‚‚ã‚ã‚Šã¾ã™ã€‚
æœ€æ‚ªã®å ´åˆã€ã“ã®ã‚ˆã†ã« `execute` ã‚’ä½¿ã£ã¦æ›¸ãã“ã¨ã‚‚ã§ãã¾ã™ã®ã§ã€è¨­å®šã§ããªã„ã“ã¨ã¯ãªã„ã¯ãšã§ã™ã€‚

https://github.com/yukimemi/dotfiles/blob/ebea69cc24b377fbdbb8606423813ee4e199a998/.config/nvim/denops/config/plugins/telescope.ts#L117-L156


## ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆæ–¹æ³•

#### ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ

ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯ `:DvpmUpdate` ã‚³ãƒãƒ³ãƒ‰ã§ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã§ãã¾ã™ã€‚
ç¾æ™‚ç‚¹ã§å”¯ä¸€æä¾›ã—ã¦ã„ã‚‹ã‚³ãƒãƒ³ãƒ‰ã§ã™ã€‚
ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã‚‚ [denops.vim](https://github.com/vim-denops/denops.vim) ä¸Šã§éåŒæœŸã«å®Ÿè¡Œã•ã‚Œã‚‹ãŸã‚ã€ Vim / Neovim ã®æ“ä½œã‚’å¦¨ã’ãšã«ã‚¹ãƒ ãƒ¼ã‚ºã«è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚

#### dvpm ã‚„ denops_std ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ

[dvpm](https://github.com/yukimemi/dvpm) ã‚„ [denops_std](https://deno.land/x/denops_std/mod.ts) ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã«ã¯ã€ [udd](https://github.com/hayd/deno-udd) ã‚’ä½¿ã†ã¨ä¾¿åˆ©ã§ã™ã€‚

`config` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•ã—ã¦ã€æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

- Mac / Linux ã®å ´åˆ (zsh)

```sh
udd **/*.ts
```

- Windows ã®å ´åˆ (PowerShell)

```powershell
udd $(gci -r -file *.ts)
```

ã“ã‚Œã«ã‚ˆã‚Šã€å„ `import` æ–‡ã® `@x.x.x` ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒæ›´æ–°ã•ã‚Œã¾ã™ã€‚

## ãŠã¾ã‘

[Deno](https://deno.com/runtime) ã‚’è¨­å®šã¨ã—ã¦åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã€ API ã®å‘¼ã³å‡ºã—ãŒéå¸¸ã«ç°¡å˜ã«æ›¸ã‘ã¾ã™ã€‚ã¾ãŸã€ [Deno](https://deno.com/runtime) ã‚„ [npm](https://www.npmjs.com/) ã® è±Šå¯Œãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚‚ä½¿ç”¨å¯èƒ½ã§ã™ã€‚

ä¾‹ãˆã°ã€å…ˆç¨‹ã® `denops/config/main.ts` ã«ä»¥ä¸‹ã‚’è¿½è¨˜ã—ã¦ã¿ã¾ã™ã€‚

```typescript
// import ã¸ä»¥ä¸‹ã‚’è¿½è¨˜
import * as buffer from "https://deno.land/x/denops_std@v5.0.0/buffer/mod.ts";

// ... çœç•¥

export async function main(denops: Denops): Promise<void> {
  // ... çœç•¥

  // main é–¢æ•°ã®æœ€å¾Œã«ä»¥ä¸‹ã‚’è¿½è¨˜
  const area = "130000";
  const res = await fetch(
    `https://www.jma.go.jp/bosai/forecast/data/overview_forecast/${area}.json`,
  );
  const msg = [
    "â˜†æ±äº¬ã®å¤©æ°—æƒ…å ±â˜†",
    "------------------------------",
    "",
    ...(await res.json()).text.split("\n"),
  ];
  const buf = await buffer.open(denops, "forecast");
  await fn.setbufvar(denops, buf.bufnr, "&buftype", "nofile");
  await fn.setbufvar(denops, buf.bufnr, "&swapfile", 0);
  await buffer.replace(denops, buf.bufnr, msg);
  await buffer.concrete(denops, buf.bufnr);
}
```

ã“ã‚Œã ã‘ã®è¨˜è¼‰ã§ Vim / Neovim èµ·å‹•æ™‚ã«ãŠå¤©æ°—æƒ…å ±ã‚’ç¢ºèªã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼

![neovim-startuptime](https://github.com/yukimemi/zenn-dev/blob/master/articles/img/weather-buffer.png?raw=true)

[nvim-notify](https://github.com/rcarriga/nvim-notify) ã‚’ä½¿ç”¨ã—ã¦ä»¥ä¸‹ã®è¨˜è¼‰ã«å¤‰æ›´ã™ã‚‹ã¨ã€é€šçŸ¥ã¨ã—ã¦ç¢ºèªã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚ã“ã‚Œã§é›¨ã®æ—¥ã‚‚å®‰å¿ƒã€‚

```typescript
export async function main(denops: Denops): Promise<void> {
  // ... çœç•¥
  // ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¸ä»¥ä¸‹ã‚’è¿½åŠ ã€‚
  await dvpm.add({
    url: "rcarriga/nvim-notify",
    after: async ({ denops }) => {
      await denops.cmd(`lua require("notify").setup()`);
    },
  });

  // main é–¢æ•°ã®æœ€å¾Œã«ä»¥ä¸‹ã‚’è¿½è¨˜
  const area = "130000";
  const res = await fetch(
    `https://www.jma.go.jp/bosai/forecast/data/overview_forecast/${area}.json`,
  );
  const msg = [
    "â˜†æ±äº¬ã®å¤©æ°—æƒ…å ±â˜†",
    "------------------------------",
    "",
    ...(await res.json()).text.split("\n"),
  ];
  await denops.call(
    `luaeval`,
    `
      require("notify")(_A.msg, vim.log.levels.INFO, {
        timeout = _A.timeout,
        on_open = function(win)
          vim.wo[win].wrap = true
        end,
      })
    `,
    { msg, timeout: 30000 },
  );
}
```

![weather-notify](https://github.com/yukimemi/zenn-dev/blob/master/articles/img/weather-notify.gif?raw=true)

ã¾ãŸã€æœ€è¿‘ã§ã¯ [ChatGPT](https://openai.com/blog/chatgpt) ã® API ã‚’ä½¿ã£ã¦æœ¬æ—¥ã®åŠ±ã¾ã—ã®ä¸€è¨€ã‚’ã‚‚ã‚‰ã†ãªã©ã€ã•ã¾ã–ã¾ãªã“ã¨ãŒã§ããã†ã§ã™ã€‚

## ãŠã‚ã‚Šã«

[denops.vim](https://github.com/vim-denops/denops.vim) ã¯éå¸¸ã«æ›¸ãã‚„ã™ãã¦æ¥½ã—ã„ã®ã§ã€ ç§ã¿ãŸã„ã«è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’å…¨ã¦ãƒ»ãƒ»ãƒ»ã¨ã„ã†ã®ã¯ã•ã™ãŒã«ã‚„ã‚Šéãã§ã™ãŒã€å…ˆç¨‹ã®ãŠå¤©æ°—é€šçŸ¥ã¿ãŸã„ãªãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã‚ã‚Œã°æœ¬å½“ã«ã™ãä½œã‚Œã¡ã‚ƒã†ã®ã§ã€ãœã²ã¨ã‚‚ä½•ã‹ä½œã£ã¦ã¿ã¦ãã ã•ã„ã€‚


